# Урок 19. Копилка

## Теория  

Копилка — это устройство для хранения монет или купюр.  
На Arduino можно сделать «умную копилку», которая не только принимает монеты, но и **считает количество или сумму**.  

Для этого можно использовать:  
- **Микропереключатель (концевик)** — срабатывает при падении монеты.  
- **ИК-датчик прерывания** — фиксирует прохождение монеты через щель.  
- **Весовой датчик** (более продвинутый вариант) — определяет, какую монету положили.  

В базовом варианте мы будем считать количество монет при помощи кнопки или датчика.  

---

## Интересные факты  

- Первая керамическая копилка в форме свиньи появилась в XIV веке в Англии.  
- Современные копилки могут определять номинал монет с помощью датчиков веса и диаметра.  
- В некоторых японских копилках есть моторчики, которые «съедают» монету, как будто игрушка оживает.  
- На Arduino можно сделать копилку, которая показывает баланс на дисплее или подаёт сигнал при определённой сумме.  

---

## Практика  

### Материалы  

- Arduino Uno (или совместимая).  
- Концевой выключатель (или кнопка).  
- Светодиод + резистор 220 Ом (индикатор).  
- Пьезо-динамик (опционально).  
- LCD 16x2 или OLED-дисплей (для отображения суммы, опционально).  
- Макетная плата, провода.  

### Подключение  

1. Кнопка/концевик → один вывод к D2, второй → GND (через `INPUT_PULLUP`).  
2. Светодиод → через резистор к D13, катод к GND.  
3. Пьезо → D8 → GND (опция).  
4. LCD/OLED подключается через I2C (SDA → A4, SCL → A5).  

---

## Программный код (простая копилка: счётчик монет)

```cpp
// Урок 19: Копилка
// Счётчик монет по нажатию кнопки (имитация падения монеты)

int buttonPin = 2;
int ledPin = 13;
int buzzerPin = 8;

volatile int coins = 0;

void setup() {
  pinMode(buttonPin, INPUT_PULLUP);
  pinMode(ledPin, OUTPUT);
  pinMode(buzzerPin, OUTPUT);
  Serial.begin(9600);

  // Используем прерывание для точного учёта
  attachInterrupt(digitalPinToInterrupt(buttonPin), coinInserted, FALLING);

  Serial.println("Копилка готова! Бросьте монету.");
}

void loop() {
  // Выводим текущее количество каждые 2 секунды
  static unsigned long lastPrint = 0;
  if (millis() - lastPrint > 2000) {
    Serial.print("Монет в копилке: ");
    Serial.println(coins);
    lastPrint = millis();
  }
}

void coinInserted() {
  coins++;
  digitalWrite(ledPin, HIGH);
  tone(buzzerPin, 1000, 200);
  delay(50);
  digitalWrite(ledPin, LOW);
}

```

Программный код (копилка с дисплеем)

```cpp
// Копилка с отображением суммы на LCD

#include <Wire.h>
#include <LiquidCrystal_I2C.h>

LiquidCrystal_I2C lcd(0x27, 16, 2);

int buttonPin = 2;
int coins = 0;

void setup() {
  pinMode(buttonPin, INPUT_PULLUP);
  lcd.init();
  lcd.backlight();
  lcd.setCursor(0,0);
  lcd.print("Копилка готова!");

  attachInterrupt(digitalPinToInterrupt(buttonPin), coinInserted, FALLING);
}

void loop() {
  lcd.setCursor(0,1);
  lcd.print("Монет: ");
  lcd.print(coins);
  delay(200);
}

void coinInserted() {
  coins++;
}
```

Эксперименты

Измените код так, чтобы каждая монета считалась как «100 тенге» и отображалась сумма.
Добавьте звуковой сигнал разной тональности для разных монет (например, короткий для мелкой, длинный для крупной).
Реализуйте «цель»: когда сумма превышает определённый порог, светодиод начинает мигать.
Используйте два концевика для имитации разных размеров монет.
Если есть OLED-дисплей, отобразите красивую анимацию при каждом пополнении.

Задание для самостоятельной работы

Нарисуйте схему подключения копилки.
Составьте таблицу: количество монет → сумма в тенге.
Добавьте кнопку «Сброс», чтобы обнулять значение монет.
Реализуйте «умную копилку-банк»: отображение цели (например, 5000 тенге) и сколько ещё нужно накопить.
Сделайте «копилку с паролем»: деньги можно «снять» только при вводе правильного кода (через кнопки или Serial Monitor).
