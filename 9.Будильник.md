# Урок 9. Будильник

## Теория  

Будильник — это устройство, которое запускает сигнал в определённое время.  
В Arduino-проектах будильники реализуются по-разному:  

1. **Простой будильник по отсчёту** — задаём длительность (например, 10 минут), по истечении времени срабатывает сигнал.  
2. **Будильник по реальному времени** — используется модуль часов реального времени (RTC, например DS1307 или DS3231), чтобы Arduino знала текущее время и могла «разбудить» в нужный час и минуту.  

В базовом наборе без RTC мы сделаем **отсчётный будильник**: задаём время (например, 1 минута), Arduino отсчитывает и запускает сигнал.  
А также покажем вариант с модулем DS3231 для тех, у кого он есть.  

---

## Интересные факты  

- Первый механический будильник с возможностью установки времени изобрёл Леви Хатчинс в 1787 году, но он мог звонить только в 4 утра.  
- Электронные будильники появились в середине XX века и сразу стали популярными благодаря точности.  
- Сегодня будильники встроены во все смартфоны, но люди всё равно покупают отдельные «умные будильники» с подсветкой, музыкой или анализом сна.  
- В космосе будильники тоже нужны: астронавтов будят музыкой или радиосигналами.  

---

## Практика  

### Материалы  

**Вариант 1: простой будильник**  
- Arduino Uno (или совместимая)  
- Светодиод + резистор 220 Ω  
- Пьезо-динамик  
- Кнопка для установки/сброса  

**Вариант 2: продвинутый будильник**  
- Всё выше  
- Модуль RTC DS3231 или DS1307 (I²C)  

---

### Подключение (вариант 1, без RTC)  

- LED: анод через 220 Ω → D13, катод → GND  
- Buzzer: один вывод → D8, другой → GND  
- Кнопка: один вывод → D2, другой → GND (через `INPUT_PULLUP`)  

---

## Программный код (вариант 1: отсчётный будильник)

```cpp
// Урок 9: Будильник (простая версия, отсчётная)
// По нажатию кнопки запускается таймер на 10 секунд,
// по окончании включается сигнал.

const int LED_PIN    = 13;
const int BUZZER_PIN = 8;
const int BTN_PIN    = 2;

bool running = false;
unsigned long tStart = 0;
unsigned long duration = 10000UL; // 10 секунд

void setup() {
  pinMode(LED_PIN, OUTPUT);
  pinMode(BUZZER_PIN, OUTPUT);
  pinMode(BTN_PIN, INPUT_PULLUP);
  Serial.begin(9600);
  Serial.println("Нажмите кнопку, чтобы запустить будильник (10 секунд).");
}

void loop() {
  if (digitalRead(BTN_PIN) == LOW && !running) {
    delay(50); // антидребезг
    if (digitalRead(BTN_PIN) == LOW) {
      running = true;
      tStart = millis();
      Serial.println("Будильник запущен!");
    }
  }

  if (running) {
    unsigned long elapsed = millis() - tStart;
    if (elapsed >= duration) {
      running = false;
      alarmSignal();
    }
  }
}

void alarmSignal() {
  Serial.println("Срабатывание будильника!");
  for (int i=0; i<6; i++) {
    digitalWrite(LED_PIN, HIGH);
    tone(BUZZER_PIN, 880);
    delay(200);
    digitalWrite(LED_PIN, LOW);
    noTone(BUZZER_PIN);
    delay(200);
  }
}

```

Программный код (вариант 2: будильник по реальному времени с DS3231)

```cpp
// Урок 9: Будильник (версия с RTC DS3231)
// Срабатывает в указанное время (часы и минуты)

#include <Wire.h>
#include "RTClib.h"

RTC_DS3231 rtc;

const int LED_PIN = 13;
const int BUZZER_PIN = 8;

int alarmHour = 7;   // 07:30
int alarmMinute = 30;
bool alarmTriggered = false;

void setup() {
  Serial.begin(9600);
  if (!rtc.begin()) {
    Serial.println("Ошибка: RTC не найден!");
    while (1);
  }
  pinMode(LED_PIN, OUTPUT);
  pinMode(BUZZER_PIN, OUTPUT);
}

void loop() {
  DateTime now = rtc.now();

  Serial.print(now.hour());
  Serial.print(":");
  Serial.println(now.minute());

  if (now.hour() == alarmHour && now.minute() == alarmMinute && !alarmTriggered) {
    alarmTriggered = true;
    alarmSignal();
  }

  if (now.minute() != alarmMinute) {
    alarmTriggered = false; // сброс для следующего дня
  }

  delay(1000);
}

void alarmSignal() {
  Serial.println("Будильник сработал!");
  for (int i=0; i<8; i++) {
    digitalWrite(LED_PIN, HIGH);
    tone(BUZZER_PIN, 1000);
    delay(300);
    digitalWrite(LED_PIN, LOW);
    noTone(BUZZER_PIN);
    delay(300);
  }
}

```

Эксперименты

Измените время будильника (например, 5 секунд отсчёт или другое время с RTC).
Сделайте «световой будильник»: светодиод плавно загорается за несколько секунд до сигнала.
Добавьте кнопку «отключения» будильника: если нажать, сигнал прекращается.
Добавьте функцию «отложить» (snooze): при нажатии будильник срабатывает снова через 1–2 минуты.
Используйте несколько светодиодов разных цветов для разной индикации (например, зелёный — ожидание, красный — сигнал).

Задание для самостоятельной работы

Нарисуйте схему подключения будильника.
Составьте таблицу: какие режимы (обычный отсчёт, по времени RTC, световой, с snooze) вы попробовали.
Реализуйте «умный будильник»: сигнал не просто пищит, а мигает в определённом ритме или играет короткую мелодию.
Сделайте «будильник-головоломку»: сигнал не выключается, пока не нажмёшь кнопку нужное количество раз или не решишь простую задачу (например, последовательное нажатие).
Если есть LCD-экран, добавьте вывод текущего времени и статуса будильника.
